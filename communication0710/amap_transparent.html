<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>高德透明地图</title>
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            background: transparent !important;
        }
    </style>
    <script src="https://webapi.amap.com/maps?v=2.0&key=09237d566854de647cf2a260def7268a"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
</head>
<body>
    <div id="map"></div>
    <script>
        const map = new AMap.Map('map', {
            viewMode: '2D',
            zoom: 15,
            center: [116.397428, 39.90923],
            mapStyle: 'amap://styles/normal',
            showLabel: false,
            features: ['bg', 'road']
        });

        window.getMapCornerCoordinates = function() {
            const bounds = map.getBounds();
            const sw = bounds.getSouthWest();
            const ne = bounds.getNorthEast();

            const nw = new AMap.LngLat(sw.lng, ne.lat);
            const se = new AMap.LngLat(ne.lng, sw.lat);

            return {
                topLeft: [nw.lng, nw.lat],
                topRight: [ne.lng, ne.lat],
                bottomRight: [se.lng, se.lat],
                bottomLeft: [sw.lng, sw.lat]
            };
        };

        function notifyPython() {
            const coords = getMapCornerCoordinates();
            console.log("即将发送角点坐标给 Python:", coords);
            if (window.pyBridge && window.pyBridge.onCornersChanged) {
                window.pyBridge.onCornersChanged(coords);
            } else {
                console.warn("pyBridge 尚未准备好。");
            }
        }

        if (typeof qt !== "undefined") {
            new QWebChannel(qt.webChannelTransport, function(channel) {
                window.pyBridge = channel.objects.pyBridge;

                notifyPython();

                map.on('moveend', notifyPython);
                map.on('zoomend', notifyPython);
            });
        } else {
            console.warn("qt is not defined. Running outside Qt environment.");
        }
    </script>
</body>
</html>